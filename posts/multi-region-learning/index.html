<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Multi region cloud training | Memo Garcia</title>
<meta name=keywords content><meta name=description content="Train teams on multi region, high throughput, chaos tested GitOps without burning money.
Assumptions/Constraints
Money note: We mock “multi region” with two Kubernetes clusters, not two AWS regions. You have two kube contexts reachable from your workstation. You control a container registry and a GitHub repo. Optional AWS: use IRSA or EKS Pod Identity in Lab 4. Labs
Part 1 - Baseline Repo and Environments Sets shared variables and task wrappers."><link rel=canonical href=https://memo.mx/posts/multi-region-learning/><meta name=google-site-verification content="G-ZRB1GGCC9B"><link crossorigin=anonymous href=/assets/css/stylesheet.d1467e28595903f993a7e37893057cefe5f69aece461c850796bf5b0a3bf422a.css integrity="sha256-0UZ+KFlZA/mTp+N4kwV87+X2muzkYchQeWv1sKO/Qio=" rel="preload stylesheet" as=style><link rel=icon href=https://memo.mx/%20favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://memo.mx/%20favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://memo.mx/%20favicon-32x32.png><link rel=apple-touch-icon href=https://memo.mx/%20apple-touch-icon.png><link rel=mask-icon href=https://memo.mx/%20safari-pinned-tab.svg><meta name=theme-color content="#0d0221"><meta name=msapplication-TileColor content="#0d0221"><link rel=alternate hreflang=en href=https://memo.mx/posts/multi-region-learning/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZRB1GGCC9B"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZRB1GGCC9B")}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://memo.mx/posts/"},{"@type":"ListItem","position":2,"name":"Multi region cloud training","item":"https://memo.mx/posts/multi-region-learning/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Multi region cloud training","name":"Multi region cloud training","description":"Train teams on multi region, high throughput, chaos tested GitOps without burning money.\nAssumptions/Constraints\nMoney note: We mock “multi region” with two Kubernetes clusters, not two AWS regions. You have two kube contexts reachable from your workstation. You control a container registry and a GitHub repo. Optional AWS: use IRSA or EKS Pod Identity in Lab 4. Labs\nPart 1 - Baseline Repo and Environments Sets shared variables and task wrappers.","keywords":[],"articleBody":"Train teams on multi region, high throughput, chaos tested GitOps without burning money.\nAssumptions/Constraints\nMoney note: We mock “multi region” with two Kubernetes clusters, not two AWS regions. You have two kube contexts reachable from your workstation. You control a container registry and a GitHub repo. Optional AWS: use IRSA or EKS Pod Identity in Lab 4. Labs\nPart 1 - Baseline Repo and Environments Sets shared variables and task wrappers. Confirms contexts and versions. Part 2 - GitOps with Argo CD Installs Argo CD and deploys one app to both clusters with ApplicationSet. Part 3 - Istio Multi Region Mesh Installs Istio with a single mesh across clusters and an east west gateway. Part 4 - AWS Identity (IRSA and Pod Identity) Gives pods AWS creds with IRSA or Pod Identity. Includes when to choose which. Part 5 - Sample App and Overlays Deploys a tiny HTTP service with region specific overlays. Part 6 - CI with GitHub Actions and Taskfile Builds and pushes images with CI that mirrors local task commands. Part 7 - CD with Istio and Argo CD Adds connection pools, outlier detection, and traffic splitting. Part 7.1 - Progressive Delivery with Argo Rollouts Uses Argo Rollouts for canary, blue green, and header based releases. Part 8 - Chaos Testing Kills pods and injects latency to prove resilience. Part 9 - Load and SLOs Generates load with k6 and checks p95 and p99 across clusters. How to Use\nSet two contexts. Example: prod-us-east-1 and prod-eu-west-1. Work through Part 1 then follow in order. Each lab is self contained and runnable. Swap in kind or k3d for local clusters to keep spend near zero. In Part 4 choose one identity path. IRSA covers EKS, Fargate, and other clusters with an OIDC provider. Pod Identity is EKS only and requires Linux EC2 nodes. ASCII Diagram (full architecture)\n[Dev Laptop] | task, kubectl, helm v [GitHub Repo] -----\u003e [GitHub Actions CI] ---\u003e [Registry (GHCR/ECR)] | | | | manifests | pushes image | v v v [GitOps Manifests (deploy/*)] | v [Argo CD (control)] / \\ v v +-----------------------+ +-----------------------+ | Cluster: US | | Cluster: EU | | ns echo | | ns echo | | istiod | | istiod | | east-west gateway |\u003c====\u003e| east-west gateway | | echo v1/v2 (sidecar)| | echo v1/v2 (sidecar)| | VS/DR (LB, retries) | | VS/DR (LB, retries) | | Chaos Mesh + k6 | | Chaos Mesh + k6 | +-----------------------+ +-----------------------+ Identity per pod (optional): [Pod + SA aws-sa] | IRSA: OIDC token -\u003e STS AssumeRoleWithWebIdentity -\u003e creds | Pod Identity: EKS agent -\u003e STS AssumeRole -\u003e creds v [AWS APIs] Notes: multi network meshID=training-mesh, trustDomain=corp.local; cross cluster via gateway + ServiceEntry. Verification/DoD\nBy the end of Lab 9, you can shift traffic, inject failure, and measure latency across two clusters. Taskfile targets in this repo\ntask k:ver prints cluster versions for both contexts. task istio:install:all installs Istio control plane in both clusters. task istio:gw:all installs an east west gateway in both clusters. task argocd:install:all installs Argo CD in both clusters. task chaos:install:all installs Chaos Mesh in both clusters. task obs:install:all installs Prometheus, Grafana, and Kiali in both clusters. Source files\nTaskfile: https://github.com/memogarcia/memogarcia.github.io/blob/master/Taskfile.yml Istio values: https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/values-istio.yaml Istio east west gateway values: https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/gateway-eastwest-values.yaml ","wordCount":"543","inLanguage":"en","datePublished":"2025-10-17T09:00:00-07:00","dateModified":"2025-10-19T11:55:59+09:00","author":{"@type":"Person","name":"Memo Garcia"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://memo.mx/posts/multi-region-learning/"},"publisher":{"@type":"Person","name":"Memo Garcia","logo":{"@type":"ImageObject","url":"https://memo.mx/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://memo.mx/ accesskey=h title="Memo Garcia (Alt + H)">Memo Garcia</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://memo.mx/labs/ title=Labs><span>Labs</span></a></li><li><a href=https://memo.mx/books/ title=Books><span>Books</span></a></li><li><a href=https://memo.mx/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Multi region cloud training</h1><div class=post-meta><span title='2025-10-17 09:00:00 -0700 -0700'>October 17, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Memo Garcia</div></header><div class=post-content><p>Train teams on multi region, high throughput, chaos tested GitOps without burning money.</p><p>Assumptions/Constraints</p><ul><li>Money note: We mock “multi region” with two Kubernetes clusters, not two AWS regions.</li><li>You have two kube contexts reachable from your workstation.</li><li>You control a container registry and a GitHub repo.</li><li>Optional AWS: use IRSA or EKS Pod Identity in Lab 4.</li></ul><p>Labs</p><ul><li><a href=/posts/multi-region-series-part-1-baseline/>Part 1 - Baseline Repo and Environments</a>
Sets shared variables and <code>task</code> wrappers. Confirms contexts and versions.</li><li><a href=/posts/multi-region-series-part-2-argocd/>Part 2 - GitOps with Argo CD</a>
Installs Argo CD and deploys one app to both clusters with ApplicationSet.</li><li><a href=/posts/multi-region-series-part-3-istio/>Part 3 - Istio Multi Region Mesh</a>
Installs Istio with a single mesh across clusters and an east west gateway.</li><li><a href=/posts/multi-region-series-part-4-identity/>Part 4 - AWS Identity (IRSA and Pod Identity)</a>
Gives pods AWS creds with IRSA or Pod Identity. Includes when to choose which.</li><li><a href=/posts/multi-region-series-part-5-app/>Part 5 - Sample App and Overlays</a>
Deploys a tiny HTTP service with region specific overlays.</li><li><a href=/posts/multi-region-series-part-6-ci/>Part 6 - CI with GitHub Actions and Taskfile</a>
Builds and pushes images with CI that mirrors local <code>task</code> commands.</li><li><a href=/posts/multi-region-series-part-7-cd/>Part 7 - CD with Istio and Argo CD</a>
Adds connection pools, outlier detection, and traffic splitting.</li><li><a href=/posts/multi-region-series-part-7a-rollouts/>Part 7.1 - Progressive Delivery with Argo Rollouts</a>
Uses Argo Rollouts for canary, blue green, and header based releases.</li><li><a href=/posts/multi-region-series-part-8-chaos/>Part 8 - Chaos Testing</a>
Kills pods and injects latency to prove resilience.</li><li><a href=/posts/multi-region-series-part-9-load/>Part 9 - Load and SLOs</a>
Generates load with k6 and checks p95 and p99 across clusters.</li></ul><p>How to Use</p><ol><li>Set two contexts. Example: <code>prod-us-east-1</code> and <code>prod-eu-west-1</code>.</li><li>Work through Part 1 then follow in order. Each lab is self contained and runnable.</li><li>Swap in kind or k3d for local clusters to keep spend near zero.</li><li>In Part 4 choose one identity path. IRSA covers EKS, Fargate, and other clusters with an OIDC provider. Pod Identity is EKS only and requires Linux EC2 nodes.</li></ol><p>ASCII Diagram (full architecture)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> [Dev Laptop]
</span></span><span class=line><span class=cl>     |  task, kubectl, helm
</span></span><span class=line><span class=cl>     v
</span></span><span class=line><span class=cl> [GitHub Repo] -----&gt; [GitHub Actions CI] ---&gt; [Registry (GHCR/ECR)]
</span></span><span class=line><span class=cl>        |                    |                        |
</span></span><span class=line><span class=cl>        | manifests          | pushes image           |
</span></span><span class=line><span class=cl>        v                    v                        v
</span></span><span class=line><span class=cl>                   [GitOps Manifests (deploy/*)]
</span></span><span class=line><span class=cl>                            |
</span></span><span class=line><span class=cl>                            v
</span></span><span class=line><span class=cl>                     [Argo CD (control)]
</span></span><span class=line><span class=cl>                         /         \
</span></span><span class=line><span class=cl>                        v           v
</span></span><span class=line><span class=cl>                 +-----------------------+      +-----------------------+
</span></span><span class=line><span class=cl>                 |  Cluster: US         |      |  Cluster: EU         |
</span></span><span class=line><span class=cl>                 |  ns echo             |      |  ns echo             |
</span></span><span class=line><span class=cl>                 |  istiod              |      |  istiod              |
</span></span><span class=line><span class=cl>                 |  east-west gateway   |&lt;====&gt;|  east-west gateway   |
</span></span><span class=line><span class=cl>                 |  echo v1/v2 (sidecar)|      |  echo v1/v2 (sidecar)|
</span></span><span class=line><span class=cl>                 |  VS/DR (LB, retries) |      |  VS/DR (LB, retries) |
</span></span><span class=line><span class=cl>                 |  Chaos Mesh + k6     |      |  Chaos Mesh + k6     |
</span></span><span class=line><span class=cl>                 +-----------------------+      +-----------------------+
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Identity per pod (optional):
</span></span><span class=line><span class=cl>   [Pod + SA aws-sa]
</span></span><span class=line><span class=cl>      |  IRSA: OIDC token -&gt; STS AssumeRoleWithWebIdentity -&gt; creds
</span></span><span class=line><span class=cl>      |  Pod Identity: EKS agent -&gt; STS AssumeRole -&gt; creds
</span></span><span class=line><span class=cl>      v
</span></span><span class=line><span class=cl>   [AWS APIs]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Notes: multi network meshID=training-mesh, trustDomain=corp.local; cross cluster via gateway + ServiceEntry.
</span></span></code></pre></div><p>Verification/DoD</p><ul><li>By the end of Lab 9, you can shift traffic, inject failure, and measure latency across two clusters.</li></ul><p>Taskfile targets in this repo</p><ul><li><code>task k:ver</code> prints cluster versions for both contexts.</li><li><code>task istio:install:all</code> installs Istio control plane in both clusters.</li><li><code>task istio:gw:all</code> installs an east west gateway in both clusters.</li><li><code>task argocd:install:all</code> installs Argo CD in both clusters.</li><li><code>task chaos:install:all</code> installs Chaos Mesh in both clusters.</li><li><code>task obs:install:all</code> installs Prometheus, Grafana, and Kiali in both clusters.</li></ul><p>Source files</p><ul><li>Taskfile: <a href=https://github.com/memogarcia/memogarcia.github.io/blob/master/Taskfile.yml>https://github.com/memogarcia/memogarcia.github.io/blob/master/Taskfile.yml</a></li><li>Istio values: <a href=https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/values-istio.yaml>https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/values-istio.yaml</a></li><li>Istio east west gateway values: <a href=https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/gateway-eastwest-values.yaml>https://github.com/memogarcia/memogarcia.github.io/blob/master/deploy/istio/gateway-eastwest-values.yaml</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://memo.mx/posts/multi-region-series-part-1-baseline/><span class=title>« Prev</span><br><span>Multi Region Cloud Training Lab: Part 1 - Baseline Repo and Environments</span>
</a><a class=next href=https://memo.mx/posts/mooomooo/><span class=title>Next »</span><br><span>mooomooo, your org as data</span></a></nav></footer></article></main><footer class=footer></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>