<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mastering Claude Code: From Basic Hooks to Production Workflows | Memo Garcia</title>
<meta name=keywords content><meta name=description content="The Problem Nobody Talks About You&rsquo;ve installed Claude Code. You&rsquo;ve written some Python. Maybe you&rsquo;ve even built a few APIs. But every time you start a new project, you&rsquo;re doing the same dance: manually formatting code, forgetting to run tests, missing edge cases in reviews, and switching mental contexts between documentation and implementation.
What if your AI assistant could handle all of this&mldr; automatically?
Here&rsquo;s what we&rsquo;re actually building: a task management API that progressively gains superpowers through Claude Code&rsquo;s configuration system."><link rel=canonical href=https://memo.mx/posts/claude-code-configuration-tutorial/><meta name=google-site-verification content="G-ZRB1GGCC9B"><link crossorigin=anonymous href=/assets/css/stylesheet.d1467e28595903f993a7e37893057cefe5f69aece461c850796bf5b0a3bf422a.css integrity="sha256-0UZ+KFlZA/mTp+N4kwV87+X2muzkYchQeWv1sKO/Qio=" rel="preload stylesheet" as=style><link rel=icon href=https://memo.mx/%20favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://memo.mx/%20favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://memo.mx/%20favicon-32x32.png><link rel=apple-touch-icon href=https://memo.mx/%20apple-touch-icon.png><link rel=mask-icon href=https://memo.mx/%20safari-pinned-tab.svg><meta name=theme-color content="#0d0221"><meta name=msapplication-TileColor content="#0d0221"><link rel=alternate hreflang=en href=https://memo.mx/posts/claude-code-configuration-tutorial/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZRB1GGCC9B"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZRB1GGCC9B")}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://memo.mx/posts/"},{"@type":"ListItem","position":2,"name":"Mastering Claude Code: From Basic Hooks to Production Workflows","item":"https://memo.mx/posts/claude-code-configuration-tutorial/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mastering Claude Code: From Basic Hooks to Production Workflows","name":"Mastering Claude Code: From Basic Hooks to Production Workflows","description":"The Problem Nobody Talks About You\u0026rsquo;ve installed Claude Code. You\u0026rsquo;ve written some Python. Maybe you\u0026rsquo;ve even built a few APIs. But every time you start a new project, you\u0026rsquo;re doing the same dance: manually formatting code, forgetting to run tests, missing edge cases in reviews, and switching mental contexts between documentation and implementation.\nWhat if your AI assistant could handle all of this\u0026hellip; automatically?\nHere\u0026rsquo;s what we\u0026rsquo;re actually building: a task management API that progressively gains superpowers through Claude Code\u0026rsquo;s configuration system.","keywords":[],"articleBody":"The Problem Nobody Talks About You’ve installed Claude Code. You’ve written some Python. Maybe you’ve even built a few APIs. But every time you start a new project, you’re doing the same dance: manually formatting code, forgetting to run tests, missing edge cases in reviews, and switching mental contexts between documentation and implementation.\nWhat if your AI assistant could handle all of this… automatically?\nHere’s what we’re actually building: a task management API that progressively gains superpowers through Claude Code’s configuration system. By the end, you’ll have an environment where Claude automatically formats your code, reviews it for security issues, adapts its output style based on what you’re doing, and even integrates with external services.\nBut here’s the thing… most tutorials show you isolated features. This one shows you how they work together.\nWhat You’ll Actually Learn We’re going to build a production-ready development environment, layer by layer:\nHooks that automatically format and validate your code Agents that review your code like a senior engineer would Output styles that adapt to whether you’re exploring or shipping MCP servers that connect to external documentation and services Orchestration that combines everything into a workflow that actually works Let’s start from zero and build something real.\nPart 1: Foundation (Basic Hooks for Code Formatting) First, let’s create our project. We’re using uv because it’s fast and it actually works.\n# Create the project structure uv init task-api cd task-api # Add our dependencies uv add fastapi uvicorn sqlalchemy pydantic-settings uv add --dev pytest pytest-asyncio black ruff mypy Now, here’s our starting API. Nothing fancy, just enough to be real:\n# src/main.py from fastapi import FastAPI, HTTPException from pydantic import BaseModel from datetime import datetime from typing import Dict, List, Optional import uuid app = FastAPI(title=\"Task API\") class Task(BaseModel): id: Optional[str] = None title: str description: Optional[str] = None completed: bool = False created_at: Optional[datetime] = None # In-memory storage for now tasks: Dict[str, Task] = {} @app.post(\"/tasks\", response_model=Task) async def create_task(task: Task): task.id = str(uuid.uuid4()) task.created_at = datetime.now() tasks[task.id] = task return task @app.get(\"/tasks\", response_model=List[Task]) async def list_tasks(): return list(tasks.values()) @app.get(\"/tasks/{task_id}\", response_model=Task) async def get_task(task_id: str): if task_id not in tasks: raise HTTPException(status_code=404, detail=\"Task not found\") return tasks[task_id] Adding Your First Hook Now for the magic. Create a .claude/hooks.yml file in your project root:\n# .claude/hooks.yml version: \"1.0\" hooks: post_file_edit: - name: \"Format Python Code\" pattern: \"**/*.py\" command: \"black {file_path}\" description: \"Automatically format Python files after editing\" - name: \"Lint Python Code\" pattern: \"**/*.py\" command: \"ruff check {file_path}\" description: \"Check for common Python issues\" continue_on_error: true # Don't block on linting errors What’s happening here? Every time Claude edits a Python file, it automatically:\nFormats it with Black (no more formatting debates) Checks it with Ruff (catches common mistakes) But wait, there’s more. Let’s add a pre-commit hook that ensures tests pass:\n# .claude/hooks.yml (continued) pre_commit: - name: \"Run Tests\" command: \"pytest tests/ -v\" description: \"Ensure tests pass before committing\" continue_on_error: false # Block commit if tests fail - name: \"Type Check\" command: \"mypy src/ --ignore-missing-imports\" description: \"Verify type hints are correct\" continue_on_error: true # Warn but don't block Observable Results Ask Claude to add a new endpoint:\nClaude, add a PATCH endpoint to update task completion status Watch what happens:\nClaude writes the code Black formats it automatically Ruff checks for issues You see the clean, validated result No manual steps. No “oh, I forgot to format.” It just works.\nPart 2: Intelligence (Code Review Agents) Hooks handle the mechanical stuff. Now let’s add intelligence.\nCreate .claude/agents.yml:\n# .claude/agents.yml version: \"1.0\" agents: security-reviewer: description: \"Reviews code for security vulnerabilities\" expertise: - OWASP Top 10 - SQL injection prevention - Input validation - Authentication patterns activation: - pattern: \"**/*.py\" trigger: \"on_edit\" prompts: review: | Review this code for security issues: - Check for SQL injection vulnerabilities - Verify input validation - Look for authentication bypasses - Check for exposed sensitive data Provide specific, actionable feedback. performance-analyst: description: \"Analyzes code for performance issues\" expertise: - Database query optimization - Async/await patterns - Memory management - Caching strategies activation: - pattern: \"**/api/**/*.py\" trigger: \"on_significant_change\" # Only on major changes prompts: analyze: | Analyze performance implications: - Database query efficiency - N+1 query problems - Memory usage patterns - Potential bottlenecks Focus on actionable improvements. Now let’s trigger these agents. Update your main.py with a deliberately problematic endpoint:\n# Add this endpoint to main.py @app.get(\"/tasks/search\") async def search_tasks(q: str): # Deliberately problematic for demonstration results = [] for task in tasks.values(): # This is inefficient and potentially unsafe if q in task.title or q in task.description: results.append(task) return results When you save this, watch the agents activate:\nSecurity Reviewer says:\n⚠️ Security Issue: Unbounded search query - No input validation on 'q' parameter - No rate limiting - Potential for regex DoS if extended to pattern matching Fix: Add query length limits and sanitization Performance Analyst says:\n⚠️ Performance Issue: O(n) search on every request - Full table scan equivalent - No indexing capability - Memory inefficient for large datasets Fix: Consider adding search indexing or pagination Agent Collaboration Here’s where it gets interesting. Agents can work together:\n# .claude/agents.yml (additional configuration) api-designer: description: \"Ensures API consistency and best practices\" collaboration: consults: [security-reviewer, performance-analyst] prompts: design: | Review API design for: - RESTful conventions - Response consistency - Error handling patterns Incorporate feedback from security and performance agents. Part 3: Adaptation (Output Styles for Different Modes) Sometimes you want quick exploration. Sometimes you need production-ready code. Let’s configure different modes.\nCreate .claude/output-styles.yml:\n# .claude/output-styles.yml version: \"1.0\" styles: exploration: description: \"Quick prototyping and idea exploration\" characteristics: verbosity: minimal comments: sparse error_handling: basic testing: skip format: code_blocks: inline explanations: brief example_trigger: \"Let's explore...\" production: description: \"Production-ready implementation\" characteristics: verbosity: comprehensive comments: detailed error_handling: robust testing: required format: code_blocks: full_file explanations: thorough includes: - Type hints - Docstrings - Error handling - Logging - Tests example_trigger: \"Production implementation...\" teaching: description: \"Educational mode with heavy explanations\" characteristics: verbosity: educational comments: extensive error_handling: demonstrative testing: explained format: code_blocks: incremental explanations: step_by_step example_trigger: \"Explain how...\" See the Difference Ask Claude the same question in different modes:\nExploration Mode:\n# Quick and dirty task filtering @app.get(\"/tasks/active\") async def get_active_tasks(): return [t for t in tasks.values() if not t.completed] Production Mode:\nfrom typing import List, Optional from fastapi import Query import logging logger = logging.getLogger(__name__) @app.get( \"/tasks/active\", response_model=List[Task], summary=\"Get active tasks\", description=\"Retrieve all tasks that are not completed\", response_description=\"List of active tasks\", ) async def get_active_tasks( limit: Optional[int] = Query( 100, ge=1, le=1000, description=\"Maximum number of tasks to return\" ), offset: Optional[int] = Query( 0, ge=0, description=\"Number of tasks to skip\" ), ) -\u003e List[Task]: \"\"\" Retrieve active (uncompleted) tasks with pagination support. Args: limit: Maximum number of tasks to return (1-1000) offset: Number of tasks to skip for pagination Returns: List of active Task objects Raises: HTTPException: If pagination parameters are invalid \"\"\" try: logger.info(f\"Fetching active tasks: limit={limit}, offset={offset}\") active_tasks = [ task for task in tasks.values() if not task.completed ] # Apply pagination paginated_tasks = active_tasks[offset:offset + limit] logger.info(f\"Returning {len(paginated_tasks)} active tasks\") return paginated_tasks except Exception as e: logger.error(f\"Error fetching active tasks: {str(e)}\") raise HTTPException( status_code=500, detail=\"Internal server error while fetching tasks\" ) Same functionality. Completely different approach based on context.\nPart 4: Extension (MCP Servers for External Integrations) Now we connect to the outside world. MCP servers let Claude access external services and documentation.\nCreate .claude/mcp-servers.yml:\n# .claude/mcp-servers.yml version: \"1.0\" servers: postgres: type: database connection: host: localhost port: 5432 database: tasks_db capabilities: - schema_inspection - query_execution - migration_generation usage: description: \"Direct database access for schema design and queries\" redis: type: cache connection: host: localhost port: 6379 capabilities: - key_operations - cache_patterns - monitoring usage: description: \"Cache management and session storage\" documentation: type: web endpoints: fastapi: \"https://fastapi.tiangolo.com/reference/\" sqlalchemy: \"https://docs.sqlalchemy.org/en/20/\" capabilities: - fetch_docs - search_api - example_retrieval usage: description: \"Fetch latest documentation and examples\" github: type: vcs repository: \"your-org/task-api\" capabilities: - issue_creation - pr_management - code_search usage: description: \"Integrate with GitHub for issue tracking\" Real Database Integration Now let’s evolve our in-memory storage to a real database:\n# src/database.py from sqlalchemy import create_engine, Column, String, Boolean, DateTime from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from datetime import datetime import os DATABASE_URL = os.getenv(\"DATABASE_URL\", \"postgresql://localhost/tasks_db\") engine = create_engine(DATABASE_URL) SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine) Base = declarative_base() class TaskModel(Base): __tablename__ = \"tasks\" id = Column(String, primary_key=True) title = Column(String, nullable=False, index=True) description = Column(String) completed = Column(Boolean, default=False, index=True) created_at = Column(DateTime, default=datetime.utcnow) updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow) # Create tables Base.metadata.create_all(bind=engine) With MCP servers configured, Claude can now:\nGenerate optimal database queries Suggest caching strategies Pull latest API documentation Create GitHub issues for bugs Observable MCP Behavior Ask Claude: “Optimize the search endpoint with database full-text search”\nClaude will:\nConnect to the postgres MCP server Check available PostgreSQL extensions Generate migration for full-text search Implement the optimized endpoint Add appropriate caching with Redis # Claude generates this with MCP assistance from sqlalchemy import func, Index from sqlalchemy.dialects.postgresql import TSVECTOR class TaskModel(Base): __tablename__ = \"tasks\" # ... existing columns ... # Full-text search vector search_vector = Column(TSVECTOR) __table_args__ = ( Index( 'idx_task_search', 'search_vector', postgresql_using='gin' ), ) @app.get(\"/tasks/search\") async def search_tasks( q: str = Query(..., min_length=1, max_length=100), db: Session = Depends(get_db) ): # MCP-assisted optimal query results = db.query(TaskModel).filter( TaskModel.search_vector.match(q) ).limit(50).all() # Redis caching based on MCP recommendations cache_key = f\"search:{q}\" cached = await redis.get(cache_key) if cached: return json.loads(cached) # ... rest of implementation Part 5: Orchestration (Complete Workflow) Now let’s bring it all together. Create .claude/workflow.yml:\n# .claude/workflow.yml version: \"1.0\" workflows: feature_development: description: \"Complete feature development workflow\" steps: - name: \"Design\" agent: api-designer style: exploration actions: - Generate endpoint specification - Define data models - name: \"Implementation\" style: production hooks: - Format Python Code - Lint Python Code actions: - Write endpoint code - Add error handling - Implement logging - name: \"Testing\" agent: test-engineer actions: - Generate unit tests - Create integration tests - Run test suite - name: \"Review\" agents: [security-reviewer, performance-analyst] actions: - Security audit - Performance analysis - Generate review report - name: \"Documentation\" style: teaching mcp_servers: [documentation] actions: - Generate API docs - Create examples - Update README hotfix: description: \"Emergency fix workflow\" steps: - name: \"Identify\" mcp_servers: [github, postgres] actions: - Analyze issue - Query database for impact - name: \"Fix\" style: production agent: security-reviewer priority: high actions: - Implement fix - Security validation - name: \"Deploy\" hooks: - Run Tests - Type Check actions: - Create hotfix PR - Run CI/CD checks Triggering a Complete Workflow Now when you tell Claude: “Implement task categories feature”, here’s what happens:\nStep 1: Design Phase\n# Claude starts in exploration mode # Generates quick spec: \"\"\" Feature: Task Categories - Each task can belong to one category - Categories: work, personal, urgent - Filter tasks by category - Category statistics endpoint \"\"\" Step 2: Implementation Phase\n# Switches to production mode # Creates migration with MCP assistance class Category(Base): __tablename__ = \"categories\" id = Column(String, primary_key=True) name = Column(String, unique=True, nullable=False) color = Column(String, default=\"#gray\") task_count = Column(Integer, default=0) # Updates Task model class TaskModel(Base): # ... existing fields ... category_id = Column(String, ForeignKey(\"categories.id\")) category = relationship(\"Category\", back_populates=\"tasks\") Step 3: Testing Phase\n# Test engineer agent generates async def test_task_categories(): async with AsyncClient(app=app, base_url=\"http://test\") as client: # Create category category_response = await client.post( \"/categories\", json={\"name\": \"work\", \"color\": \"#blue\"} ) assert category_response.status_code == 201 # Create task with category task_response = await client.post( \"/tasks\", json={ \"title\": \"Review PR\", \"category_id\": category_response.json()[\"id\"] } ) assert task_response.status_code == 201 assert task_response.json()[\"category\"][\"name\"] == \"work\" Step 4: Review Phase\nSecurity Review: ✅ PASSED - Input validation present - No SQL injection vectors - Proper authorization checks Performance Review: ⚠️ NEEDS OPTIMIZATION - Consider indexing category_id - Add eager loading for category relationship - Implement category count caching Step 5: Documentation\n## Task Categories Tasks can now be organized into categories for better organization. ### Creating a Category POST /categories { \"name\": \"work\", \"color\": \"#0066cc\" } ### Assigning Tasks to Categories POST /tasks { \"title\": \"Complete project\", \"category_id\": \"category-123\" } ### Filtering by Category GET /tasks?category=work Returns all tasks in the \"work\" category... Troubleshooting Common Issues Hooks Not Firing Check your .claude/hooks.yml syntax:\n# ❌ Wrong hooks: post_file_edit: name: \"Format\" # Missing list structure # ✅ Correct hooks: post_file_edit: - name: \"Format\" # Proper list item Agents Not Activating Verify activation patterns:\n# ❌ Too specific activation: - pattern: \"/home/user/project/src/main.py\" # ✅ Flexible activation: - pattern: \"**/*.py\" MCP Connection Failures Test connections manually:\n# Test database connection psql -h localhost -U user -d tasks_db -c \"SELECT 1\" # Test Redis redis-cli ping Style Not Switching Be explicit in your prompts:\n# ❌ Ambiguous \"Add a new endpoint\" # ✅ Clear mode indication \"Production implementation: Add a new endpoint with full error handling\" Advanced Patterns Conditional Hooks hooks: post_file_edit: - name: \"Format Large Files\" pattern: \"**/*.py\" condition: \"file_size \u003e 1000\" # Only for files over 1KB command: \"black {file_path}\" Agent Chaining agents: architect: triggers_next: [implementer, tester] implementer: requires_approval_from: [architect] triggers_next: [tester] tester: final: true generates_report: true Dynamic MCP Configuration servers: database: type: dynamic config_from_env: - DATABASE_URL - DB_POOL_SIZE fallback: type: sqlite path: \"./dev.db\" Where This Goes Next You’ve built a development environment that:\nAutomatically formats and validates code Reviews changes for security and performance Adapts output based on your current needs Integrates with external services and documentation Orchestrates complex workflows automatically But here’s the real power: this isn’t just about saving time. It’s about maintaining consistency, catching issues early, and letting you focus on the interesting problems instead of the repetitive ones.\nSome ideas for extending this:\nAdd monitoring MCP servers for production insights Create specialized agents for your domain (e.g., payment-security-expert) Build workflow templates for common tasks Integrate with your CI/CD pipeline The key insight? Claude Code isn’t just an AI assistant. With proper configuration, it becomes a complete development environment that understands your standards, enforces your practices, and accelerates your workflow.\nMaybe you don’t need all of this. Maybe you just want the formatting hooks. That’s fine too. Start small, add what provides value, skip what doesn’t.\nBut now you know what’s possible.\nThe Configuration Files You Need Here’s everything in one place for easy copy-paste:\nComplete Project Structure task-api/ ├── .claude/ │ ├── hooks.yml │ ├── agents.yml │ ├── output-styles.yml │ ├── mcp-servers.yml │ └── workflow.yml ├── src/ │ ├── main.py │ ├── database.py │ └── models.py ├── tests/ │ └── test_api.py ├── pyproject.toml └── .env Remember: configuration is powerful, but it’s not magic. It’s about encoding your best practices so they happen automatically. Start with what annoys you most, automate that, then build from there.\nThe best development environment is the one that gets out of your way and lets you focus on solving interesting problems.\nNow go build something cool.\nNote: This tutorial assumes Claude Code v2.0+ with MCP support. Some features may vary based on your Claude Code version and available MCP servers.\n","wordCount":"2471","inLanguage":"en","datePublished":"2025-01-19T10:00:00-06:00","dateModified":"2025-08-19T19:44:37+09:00","author":{"@type":"Person","name":"Memo Garcia"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://memo.mx/posts/claude-code-configuration-tutorial/"},"publisher":{"@type":"Person","name":"Memo Garcia","logo":{"@type":"ImageObject","url":"https://memo.mx/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://memo.mx/ accesskey=h title="Memo Garcia (Alt + H)">Memo Garcia</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://memo.mx/tools title=Tools><span>Tools</span></a></li><li><a href=https://memo.mx/books title=Books><span>Books</span></a></li><li><a href=https://memo.mx/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Mastering Claude Code: From Basic Hooks to Production Workflows</h1><div class=post-meta><span title='2025-01-19 10:00:00 -0600 -0600'>January 19, 2025</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Memo Garcia</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-problem-nobody-talks-about aria-label="The Problem Nobody Talks About">The Problem Nobody Talks About</a></li><li><a href=#what-youll-actually-learn aria-label="What You&amp;rsquo;ll Actually Learn">What You&rsquo;ll Actually Learn</a></li><li><a href=#part-1-foundation-basic-hooks-for-code-formatting aria-label="Part 1: Foundation (Basic Hooks for Code Formatting)">Part 1: Foundation (Basic Hooks for Code Formatting)</a><ul><li><a href=#adding-your-first-hook aria-label="Adding Your First Hook">Adding Your First Hook</a></li><li><a href=#observable-results aria-label="Observable Results">Observable Results</a></li></ul></li><li><a href=#part-2-intelligence-code-review-agents aria-label="Part 2: Intelligence (Code Review Agents)">Part 2: Intelligence (Code Review Agents)</a><ul><li><a href=#agent-collaboration aria-label="Agent Collaboration">Agent Collaboration</a></li></ul></li><li><a href=#part-3-adaptation-output-styles-for-different-modes aria-label="Part 3: Adaptation (Output Styles for Different Modes)">Part 3: Adaptation (Output Styles for Different Modes)</a><ul><li><a href=#see-the-difference aria-label="See the Difference">See the Difference</a></li></ul></li><li><a href=#part-4-extension-mcp-servers-for-external-integrations aria-label="Part 4: Extension (MCP Servers for External Integrations)">Part 4: Extension (MCP Servers for External Integrations)</a><ul><li><a href=#real-database-integration aria-label="Real Database Integration">Real Database Integration</a></li><li><a href=#observable-mcp-behavior aria-label="Observable MCP Behavior">Observable MCP Behavior</a></li></ul></li><li><a href=#part-5-orchestration-complete-workflow aria-label="Part 5: Orchestration (Complete Workflow)">Part 5: Orchestration (Complete Workflow)</a><ul><li><a href=#triggering-a-complete-workflow aria-label="Triggering a Complete Workflow">Triggering a Complete Workflow</a></li></ul></li><li><a href=#troubleshooting-common-issues aria-label="Troubleshooting Common Issues">Troubleshooting Common Issues</a><ul><li><a href=#hooks-not-firing aria-label="Hooks Not Firing">Hooks Not Firing</a></li><li><a href=#agents-not-activating aria-label="Agents Not Activating">Agents Not Activating</a></li><li><a href=#mcp-connection-failures aria-label="MCP Connection Failures">MCP Connection Failures</a></li><li><a href=#style-not-switching aria-label="Style Not Switching">Style Not Switching</a></li></ul></li><li><a href=#advanced-patterns aria-label="Advanced Patterns">Advanced Patterns</a><ul><li><a href=#conditional-hooks aria-label="Conditional Hooks">Conditional Hooks</a></li><li><a href=#agent-chaining aria-label="Agent Chaining">Agent Chaining</a></li><li><a href=#dynamic-mcp-configuration aria-label="Dynamic MCP Configuration">Dynamic MCP Configuration</a></li></ul></li><li><a href=#where-this-goes-next aria-label="Where This Goes Next">Where This Goes Next</a></li><li><a href=#the-configuration-files-you-need aria-label="The Configuration Files You Need">The Configuration Files You Need</a><ul><li><a href=#complete-project-structure aria-label="Complete Project Structure">Complete Project Structure</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=the-problem-nobody-talks-about>The Problem Nobody Talks About<a hidden class=anchor aria-hidden=true href=#the-problem-nobody-talks-about>#</a></h2><p>You&rsquo;ve installed Claude Code. You&rsquo;ve written some Python. Maybe you&rsquo;ve even built a few APIs. But every time you start a new project, you&rsquo;re doing the same dance: manually formatting code, forgetting to run tests, missing edge cases in reviews, and switching mental contexts between documentation and implementation.</p><p>What if your AI assistant could handle all of this&mldr; automatically?</p><p>Here&rsquo;s what we&rsquo;re actually building: a task management API that progressively gains superpowers through Claude Code&rsquo;s configuration system. By the end, you&rsquo;ll have an environment where Claude automatically formats your code, reviews it for security issues, adapts its output style based on what you&rsquo;re doing, and even integrates with external services.</p><p>But here&rsquo;s the thing&mldr; most tutorials show you isolated features. This one shows you how they work together.</p><h2 id=what-youll-actually-learn>What You&rsquo;ll Actually Learn<a hidden class=anchor aria-hidden=true href=#what-youll-actually-learn>#</a></h2><p>We&rsquo;re going to build a production-ready development environment, layer by layer:</p><ol><li><strong>Hooks</strong> that automatically format and validate your code</li><li><strong>Agents</strong> that review your code like a senior engineer would</li><li><strong>Output styles</strong> that adapt to whether you&rsquo;re exploring or shipping</li><li><strong>MCP servers</strong> that connect to external documentation and services</li><li><strong>Orchestration</strong> that combines everything into a workflow that actually works</li></ol><p>Let&rsquo;s start from zero and build something real.</p><h2 id=part-1-foundation-basic-hooks-for-code-formatting>Part 1: Foundation (Basic Hooks for Code Formatting)<a hidden class=anchor aria-hidden=true href=#part-1-foundation-basic-hooks-for-code-formatting>#</a></h2><p>First, let&rsquo;s create our project. We&rsquo;re using <code>uv</code> because it&rsquo;s fast and it actually works.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create the project structure</span>
</span></span><span class=line><span class=cl>uv init task-api
</span></span><span class=line><span class=cl><span class=nb>cd</span> task-api
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Add our dependencies</span>
</span></span><span class=line><span class=cl>uv add fastapi uvicorn sqlalchemy pydantic-settings
</span></span><span class=line><span class=cl>uv add --dev pytest pytest-asyncio black ruff mypy
</span></span></code></pre></div><p>Now, here&rsquo;s our starting API. Nothing fancy, just enough to be real:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># src/main.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s2>&#34;Task API&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Task</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>completed</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># In-memory storage for now</span>
</span></span><span class=line><span class=cl><span class=n>tasks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Task</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/tasks&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Task</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_task</span><span class=p>(</span><span class=n>task</span><span class=p>:</span> <span class=n>Task</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>task</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>task</span><span class=o>.</span><span class=n>created_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>tasks</span><span class=p>[</span><span class=n>task</span><span class=o>.</span><span class=n>id</span><span class=p>]</span> <span class=o>=</span> <span class=n>task</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/tasks&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>List</span><span class=p>[</span><span class=n>Task</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>list_tasks</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>tasks</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/tasks/</span><span class=si>{task_id}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Task</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_task</span><span class=p>(</span><span class=n>task_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>task_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>tasks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Task not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tasks</span><span class=p>[</span><span class=n>task_id</span><span class=p>]</span>
</span></span></code></pre></div><h3 id=adding-your-first-hook>Adding Your First Hook<a hidden class=anchor aria-hidden=true href=#adding-your-first-hook>#</a></h3><p>Now for the magic. Create a <code>.claude/hooks.yml</code> file in your project root:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/hooks.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>post_file_edit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Format Python Code&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/*.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;black {file_path}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Automatically format Python files after editing&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Lint Python Code&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/*.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ruff check {file_path}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Check for common Python issues&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>continue_on_error</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Don&#39;t block on linting errors</span><span class=w>
</span></span></span></code></pre></div><p>What&rsquo;s happening here? Every time Claude edits a Python file, it automatically:</p><ol><li>Formats it with Black (no more formatting debates)</li><li>Checks it with Ruff (catches common mistakes)</li></ol><p>But wait, there&rsquo;s more. Let&rsquo;s add a pre-commit hook that ensures tests pass:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/hooks.yml (continued)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pre_commit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Run Tests&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;pytest tests/ -v&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Ensure tests pass before committing&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>continue_on_error</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>  </span><span class=c># Block commit if tests fail</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Type Check&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;mypy src/ --ignore-missing-imports&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Verify type hints are correct&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>continue_on_error</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Warn but don&#39;t block</span><span class=w>
</span></span></span></code></pre></div><h3 id=observable-results>Observable Results<a hidden class=anchor aria-hidden=true href=#observable-results>#</a></h3><p>Ask Claude to add a new endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Claude, add a PATCH endpoint to update task completion status
</span></span></code></pre></div><p>Watch what happens:</p><ol><li>Claude writes the code</li><li>Black formats it automatically</li><li>Ruff checks for issues</li><li>You see the clean, validated result</li></ol><p>No manual steps. No &ldquo;oh, I forgot to format.&rdquo; It just works.</p><h2 id=part-2-intelligence-code-review-agents>Part 2: Intelligence (Code Review Agents)<a hidden class=anchor aria-hidden=true href=#part-2-intelligence-code-review-agents>#</a></h2><p>Hooks handle the mechanical stuff. Now let&rsquo;s add intelligence.</p><p>Create <code>.claude/agents.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/agents.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agents</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>security-reviewer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Reviews code for security vulnerabilities&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expertise</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>OWASP Top 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SQL injection prevention</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Input validation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Authentication patterns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>activation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/*.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;on_edit&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prompts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>review</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        Review this code for security issues:
</span></span></span><span class=line><span class=cl><span class=sd>        - Check for SQL injection vulnerabilities
</span></span></span><span class=line><span class=cl><span class=sd>        - Verify input validation
</span></span></span><span class=line><span class=cl><span class=sd>        - Look for authentication bypasses
</span></span></span><span class=line><span class=cl><span class=sd>        - Check for exposed sensitive data
</span></span></span><span class=line><span class=cl><span class=sd>        Provide specific, actionable feedback.</span><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>performance-analyst</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Analyzes code for performance issues&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expertise</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Database query optimization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Async/await patterns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Memory management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Caching strategies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>activation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/api/**/*.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;on_significant_change&#34;</span><span class=w>  </span><span class=c># Only on major changes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prompts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>analyze</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        Analyze performance implications:
</span></span></span><span class=line><span class=cl><span class=sd>        - Database query efficiency
</span></span></span><span class=line><span class=cl><span class=sd>        - N+1 query problems
</span></span></span><span class=line><span class=cl><span class=sd>        - Memory usage patterns
</span></span></span><span class=line><span class=cl><span class=sd>        - Potential bottlenecks
</span></span></span><span class=line><span class=cl><span class=sd>        Focus on actionable improvements.</span><span class=w>        
</span></span></span></code></pre></div><p>Now let&rsquo;s trigger these agents. Update your main.py with a deliberately problematic endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Add this endpoint to main.py</span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/tasks/search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>search_tasks</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Deliberately problematic for demonstration</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>tasks</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1># This is inefficient and potentially unsafe</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>q</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>title</span> <span class=ow>or</span> <span class=n>q</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>description</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></div><p>When you save this, watch the agents activate:</p><p><strong>Security Reviewer says:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>⚠️ Security Issue: Unbounded search query
</span></span><span class=line><span class=cl>- No input validation on &#39;q&#39; parameter
</span></span><span class=line><span class=cl>- No rate limiting
</span></span><span class=line><span class=cl>- Potential for regex DoS if extended to pattern matching
</span></span><span class=line><span class=cl>Fix: Add query length limits and sanitization
</span></span></code></pre></div><p><strong>Performance Analyst says:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>⚠️ Performance Issue: O(n) search on every request
</span></span><span class=line><span class=cl>- Full table scan equivalent
</span></span><span class=line><span class=cl>- No indexing capability
</span></span><span class=line><span class=cl>- Memory inefficient for large datasets
</span></span><span class=line><span class=cl>Fix: Consider adding search indexing or pagination
</span></span></code></pre></div><h3 id=agent-collaboration>Agent Collaboration<a hidden class=anchor aria-hidden=true href=#agent-collaboration>#</a></h3><p>Here&rsquo;s where it gets interesting. Agents can work together:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/agents.yml (additional configuration)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>api-designer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Ensures API consistency and best practices&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collaboration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>consults</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>security-reviewer, performance-analyst]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prompts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>design</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        Review API design for:
</span></span></span><span class=line><span class=cl><span class=sd>        - RESTful conventions
</span></span></span><span class=line><span class=cl><span class=sd>        - Response consistency
</span></span></span><span class=line><span class=cl><span class=sd>        - Error handling patterns
</span></span></span><span class=line><span class=cl><span class=sd>        Incorporate feedback from security and performance agents.</span><span class=w>        
</span></span></span></code></pre></div><h2 id=part-3-adaptation-output-styles-for-different-modes>Part 3: Adaptation (Output Styles for Different Modes)<a hidden class=anchor aria-hidden=true href=#part-3-adaptation-output-styles-for-different-modes>#</a></h2><p>Sometimes you want quick exploration. Sometimes you need production-ready code. Let&rsquo;s configure different modes.</p><p>Create <code>.claude/output-styles.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/output-styles.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>styles</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exploration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Quick prototyping and idea exploration&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>characteristics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>minimal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>comments</span><span class=p>:</span><span class=w> </span><span class=l>sparse</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=l>basic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>testing</span><span class=p>:</span><span class=w> </span><span class=l>skip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>format</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>code_blocks</span><span class=p>:</span><span class=w> </span><span class=l>inline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>explanations</span><span class=p>:</span><span class=w> </span><span class=l>brief</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example_trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Let&#39;s explore...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>production</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Production-ready implementation&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>characteristics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>comprehensive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>comments</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=l>robust</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>testing</span><span class=p>:</span><span class=w> </span><span class=l>required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>format</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>code_blocks</span><span class=p>:</span><span class=w> </span><span class=l>full_file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>explanations</span><span class=p>:</span><span class=w> </span><span class=l>thorough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>includes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Type hints</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Docstrings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Error handling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>Tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example_trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Production implementation...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>teaching</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Educational mode with heavy explanations&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>characteristics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>educational</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>comments</span><span class=p>:</span><span class=w> </span><span class=l>extensive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=l>demonstrative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>testing</span><span class=p>:</span><span class=w> </span><span class=l>explained</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>format</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>code_blocks</span><span class=p>:</span><span class=w> </span><span class=l>incremental</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>explanations</span><span class=p>:</span><span class=w> </span><span class=l>step_by_step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example_trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Explain how...&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=see-the-difference>See the Difference<a hidden class=anchor aria-hidden=true href=#see-the-difference>#</a></h3><p>Ask Claude the same question in different modes:</p><p><strong>Exploration Mode:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Quick and dirty task filtering</span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/tasks/active&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_active_tasks</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>tasks</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>t</span><span class=o>.</span><span class=n>completed</span><span class=p>]</span>
</span></span></code></pre></div><p><strong>Production Mode:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Query</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/tasks/active&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>List</span><span class=p>[</span><span class=n>Task</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;Get active tasks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Retrieve all tasks that are not completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_description</span><span class=o>=</span><span class=s2>&#34;List of active tasks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_active_tasks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>limit</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ge</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>le</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Maximum number of tasks to return&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>offset</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of tasks to skip&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Task</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Retrieve active (uncompleted) tasks with pagination support.
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        limit: Maximum number of tasks to return (1-1000)
</span></span></span><span class=line><span class=cl><span class=s2>        offset: Number of tasks to skip for pagination
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        List of active Task objects
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Raises:
</span></span></span><span class=line><span class=cl><span class=s2>        HTTPException: If pagination parameters are invalid
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Fetching active tasks: limit=</span><span class=si>{</span><span class=n>limit</span><span class=si>}</span><span class=s2>, offset=</span><span class=si>{</span><span class=n>offset</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>active_tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>task</span> <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>tasks</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>task</span><span class=o>.</span><span class=n>completed</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Apply pagination</span>
</span></span><span class=line><span class=cl>        <span class=n>paginated_tasks</span> <span class=o>=</span> <span class=n>active_tasks</span><span class=p>[</span><span class=n>offset</span><span class=p>:</span><span class=n>offset</span> <span class=o>+</span> <span class=n>limit</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Returning </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>paginated_tasks</span><span class=p>)</span><span class=si>}</span><span class=s2> active tasks&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>paginated_tasks</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error fetching active tasks: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Internal server error while fetching tasks&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></div><p>Same functionality. Completely different approach based on context.</p><h2 id=part-4-extension-mcp-servers-for-external-integrations>Part 4: Extension (MCP Servers for External Integrations)<a hidden class=anchor aria-hidden=true href=#part-4-extension-mcp-servers-for-external-integrations>#</a></h2><p>Now we connect to the outside world. MCP servers let Claude access external services and documentation.</p><p>Create <code>.claude/mcp-servers.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/mcp-servers.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>localhost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=l>tasks_db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>capabilities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>schema_inspection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>query_execution</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>migration_generation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>usage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Direct database access for schema design and queries&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>localhost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>capabilities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>key_operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>cache_patterns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>monitoring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>usage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Cache management and session storage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>documentation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fastapi</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://fastapi.tiangolo.com/reference/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>sqlalchemy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://docs.sqlalchemy.org/en/20/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>capabilities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>fetch_docs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>search_api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>example_retrieval</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>usage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Fetch latest documentation and examples&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>github</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>vcs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;your-org/task-api&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>capabilities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>issue_creation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>pr_management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>code_search</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>usage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Integrate with GitHub for issue tracking&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=real-database-integration>Real Database Integration<a hidden class=anchor aria-hidden=true href=#real-database-integration>#</a></h3><p>Now let&rsquo;s evolve our in-memory storage to a real database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># src/database.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span><span class=p>,</span> <span class=n>Column</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=n>Boolean</span><span class=p>,</span> <span class=n>DateTime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.ext.declarative</span> <span class=kn>import</span> <span class=n>declarative_base</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DATABASE_URL</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;DATABASE_URL&#34;</span><span class=p>,</span> <span class=s2>&#34;postgresql://localhost/tasks_db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=n>DATABASE_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>SessionLocal</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>autoflush</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TaskModel</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;tasks&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>completed</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Boolean</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>updated_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>,</span> <span class=n>onupdate</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create tables</span>
</span></span><span class=line><span class=cl><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span></code></pre></div><p>With MCP servers configured, Claude can now:</p><ul><li>Generate optimal database queries</li><li>Suggest caching strategies</li><li>Pull latest API documentation</li><li>Create GitHub issues for bugs</li></ul><h3 id=observable-mcp-behavior>Observable MCP Behavior<a hidden class=anchor aria-hidden=true href=#observable-mcp-behavior>#</a></h3><p>Ask Claude: &ldquo;Optimize the search endpoint with database full-text search&rdquo;</p><p>Claude will:</p><ol><li>Connect to the postgres MCP server</li><li>Check available PostgreSQL extensions</li><li>Generate migration for full-text search</li><li>Implement the optimized endpoint</li><li>Add appropriate caching with Redis</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Claude generates this with MCP assistance</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>func</span><span class=p>,</span> <span class=n>Index</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.dialects.postgresql</span> <span class=kn>import</span> <span class=n>TSVECTOR</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TaskModel</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;tasks&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ... existing columns ...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Full-text search vector</span>
</span></span><span class=line><span class=cl>    <span class=n>search_vector</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>TSVECTOR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>__table_args__</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>Index</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;idx_task_search&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;search_vector&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>postgresql_using</span><span class=o>=</span><span class=s1>&#39;gin&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/tasks/search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>search_tasks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>min_length</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=p>:</span> <span class=n>Session</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>get_db</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># MCP-assisted optimal query</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>TaskModel</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>TaskModel</span><span class=o>.</span><span class=n>search_vector</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Redis caching based on MCP recommendations</span>
</span></span><span class=line><span class=cl>    <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;search:</span><span class=si>{</span><span class=n>q</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cached</span> <span class=o>=</span> <span class=k>await</span> <span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cached</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ... rest of implementation</span>
</span></span></code></pre></div><h2 id=part-5-orchestration-complete-workflow>Part 5: Orchestration (Complete Workflow)<a hidden class=anchor aria-hidden=true href=#part-5-orchestration-complete-workflow>#</a></h2><p>Now let&rsquo;s bring it all together. Create <code>.claude/workflow.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .claude/workflow.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>workflows</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>feature_development</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Complete feature development workflow&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Design&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>agent</span><span class=p>:</span><span class=w> </span><span class=l>api-designer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>style</span><span class=p>:</span><span class=w> </span><span class=l>exploration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Generate endpoint specification</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Define data models</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Implementation&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>style</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Format Python Code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Lint Python Code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Write endpoint code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Add error handling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Implement logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Testing&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>agent</span><span class=p>:</span><span class=w> </span><span class=l>test-engineer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Generate unit tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Create integration tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Run test suite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Review&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>agents</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>security-reviewer, performance-analyst]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Security audit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Performance analysis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Generate review report</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Documentation&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>style</span><span class=p>:</span><span class=w> </span><span class=l>teaching</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mcp_servers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>documentation]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Generate API docs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Create examples</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Update README</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hotfix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Emergency fix workflow&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Identify&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mcp_servers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>github, postgres]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Analyze issue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Query database for impact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Fix&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>style</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>agent</span><span class=p>:</span><span class=w> </span><span class=l>security-reviewer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class=l>high</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Implement fix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Security validation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Deploy&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Run Tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Type Check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Create hotfix PR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Run CI/CD checks</span><span class=w>
</span></span></span></code></pre></div><h3 id=triggering-a-complete-workflow>Triggering a Complete Workflow<a hidden class=anchor aria-hidden=true href=#triggering-a-complete-workflow>#</a></h3><p>Now when you tell Claude: &ldquo;Implement task categories feature&rdquo;, here&rsquo;s what happens:</p><p><strong>Step 1: Design Phase</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Claude starts in exploration mode</span>
</span></span><span class=line><span class=cl><span class=c1># Generates quick spec:</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Feature: Task Categories
</span></span></span><span class=line><span class=cl><span class=s2>- Each task can belong to one category
</span></span></span><span class=line><span class=cl><span class=s2>- Categories: work, personal, urgent
</span></span></span><span class=line><span class=cl><span class=s2>- Filter tasks by category
</span></span></span><span class=line><span class=cl><span class=s2>- Category statistics endpoint
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p><strong>Step 2: Implementation Phase</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Switches to production mode</span>
</span></span><span class=line><span class=cl><span class=c1># Creates migration with MCP assistance</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Category</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;categories&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>&#34;#gray&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>task_count</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Updates Task model</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TaskModel</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ... existing fields ...</span>
</span></span><span class=line><span class=cl>    <span class=n>category_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&#34;categories.id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&#34;Category&#34;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&#34;tasks&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Step 3: Testing Phase</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Test engineer agent generates</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>test_task_categories</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>AsyncClient</span><span class=p>(</span><span class=n>app</span><span class=o>=</span><span class=n>app</span><span class=p>,</span> <span class=n>base_url</span><span class=o>=</span><span class=s2>&#34;http://test&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Create category</span>
</span></span><span class=line><span class=cl>        <span class=n>category_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/categories&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;work&#34;</span><span class=p>,</span> <span class=s2>&#34;color&#34;</span><span class=p>:</span> <span class=s2>&#34;#blue&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>category_response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Create task with category</span>
</span></span><span class=line><span class=cl>        <span class=n>task_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/tasks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Review PR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;category_id&#34;</span><span class=p>:</span> <span class=n>category_response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>task_response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>task_response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;category&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;work&#34;</span>
</span></span></code></pre></div><p><strong>Step 4: Review Phase</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Security</span> <span class=n>Review</span><span class=p>:</span> <span class=err>✅</span> <span class=n>PASSED</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=ne>Input</span> <span class=n>validation</span> <span class=n>present</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>No</span> <span class=n>SQL</span> <span class=n>injection</span> <span class=n>vectors</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Proper</span> <span class=n>authorization</span> <span class=n>checks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=ne>Performance</span> <span class=n>Review</span><span class=p>:</span> <span class=err>⚠️</span> <span class=n>NEEDS</span> <span class=n>OPTIMIZATION</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Consider</span> <span class=n>indexing</span> <span class=n>category_id</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Add</span> <span class=n>eager</span> <span class=n>loading</span> <span class=k>for</span> <span class=n>category</span> <span class=n>relationship</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Implement</span> <span class=n>category</span> <span class=n>count</span> <span class=n>caching</span>
</span></span></code></pre></div><p><strong>Step 5: Documentation</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl><span class=gu>## Task Categories
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>Tasks can now be organized into categories for better organization.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>### Creating a Category
</span></span></span><span class=line><span class=cl><span class=gu></span>POST /categories
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;name&#34;: &#34;work&#34;,
</span></span><span class=line><span class=cl>  &#34;color&#34;: &#34;#0066cc&#34;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>### Assigning Tasks to Categories
</span></span></span><span class=line><span class=cl><span class=gu></span>POST /tasks
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;title&#34;: &#34;Complete project&#34;,
</span></span><span class=line><span class=cl>  &#34;category_id&#34;: &#34;category-123&#34;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>### Filtering by Category
</span></span></span><span class=line><span class=cl><span class=gu></span>GET /tasks?category=work
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Returns all tasks in the &#34;work&#34; category...
</span></span></code></pre></div><h2 id=troubleshooting-common-issues>Troubleshooting Common Issues<a hidden class=anchor aria-hidden=true href=#troubleshooting-common-issues>#</a></h2><h3 id=hooks-not-firing>Hooks Not Firing<a hidden class=anchor aria-hidden=true href=#hooks-not-firing>#</a></h3><p>Check your <code>.claude/hooks.yml</code> syntax:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ❌ Wrong</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>post_file_edit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Format&#34;</span><span class=w>  </span><span class=c># Missing list structure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ✅ Correct  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>post_file_edit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Format&#34;</span><span class=w>  </span><span class=c># Proper list item</span><span class=w>
</span></span></span></code></pre></div><h3 id=agents-not-activating>Agents Not Activating<a hidden class=anchor aria-hidden=true href=#agents-not-activating>#</a></h3><p>Verify activation patterns:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ❌ Too specific</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>activation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/home/user/project/src/main.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ✅ Flexible</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>activation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/*.py&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=mcp-connection-failures>MCP Connection Failures<a hidden class=anchor aria-hidden=true href=#mcp-connection-failures>#</a></h3><p>Test connections manually:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Test database connection</span>
</span></span><span class=line><span class=cl>psql -h localhost -U user -d tasks_db -c <span class=s2>&#34;SELECT 1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test Redis</span>
</span></span><span class=line><span class=cl>redis-cli ping
</span></span></code></pre></div><h3 id=style-not-switching>Style Not Switching<a hidden class=anchor aria-hidden=true href=#style-not-switching>#</a></h3><p>Be explicit in your prompts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># ❌ Ambiguous
</span></span><span class=line><span class=cl>&#34;Add a new endpoint&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># ✅ Clear mode indication
</span></span><span class=line><span class=cl>&#34;Production implementation: Add a new endpoint with full error handling&#34;
</span></span></code></pre></div><h2 id=advanced-patterns>Advanced Patterns<a hidden class=anchor aria-hidden=true href=#advanced-patterns>#</a></h2><h3 id=conditional-hooks>Conditional Hooks<a hidden class=anchor aria-hidden=true href=#conditional-hooks>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>post_file_edit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Format Large Files&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;**/*.py&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;file_size &gt; 1000&#34;</span><span class=w>  </span><span class=c># Only for files over 1KB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;black {file_path}&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=agent-chaining>Agent Chaining<a hidden class=anchor aria-hidden=true href=#agent-chaining>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>agents</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>architect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>triggers_next</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>implementer, tester]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>implementer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requires_approval_from</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>architect]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>triggers_next</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>tester]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tester</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>final</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>generates_report</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><h3 id=dynamic-mcp-configuration>Dynamic MCP Configuration<a hidden class=anchor aria-hidden=true href=#dynamic-mcp-configuration>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>dynamic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config_from_env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POOL_SIZE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fallback</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>sqlite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./dev.db&#34;</span><span class=w>
</span></span></span></code></pre></div><h2 id=where-this-goes-next>Where This Goes Next<a hidden class=anchor aria-hidden=true href=#where-this-goes-next>#</a></h2><p>You&rsquo;ve built a development environment that:</p><ul><li>Automatically formats and validates code</li><li>Reviews changes for security and performance</li><li>Adapts output based on your current needs</li><li>Integrates with external services and documentation</li><li>Orchestrates complex workflows automatically</li></ul><p>But here&rsquo;s the real power: this isn&rsquo;t just about saving time. It&rsquo;s about maintaining consistency, catching issues early, and letting you focus on the interesting problems instead of the repetitive ones.</p><p>Some ideas for extending this:</p><ul><li>Add monitoring MCP servers for production insights</li><li>Create specialized agents for your domain (e.g., <code>payment-security-expert</code>)</li><li>Build workflow templates for common tasks</li><li>Integrate with your CI/CD pipeline</li></ul><p>The key insight? Claude Code isn&rsquo;t just an AI assistant. With proper configuration, it becomes a complete development environment that understands your standards, enforces your practices, and accelerates your workflow.</p><p>Maybe you don&rsquo;t need all of this. Maybe you just want the formatting hooks. That&rsquo;s fine too. Start small, add what provides value, skip what doesn&rsquo;t.</p><p>But now you know what&rsquo;s possible.</p><h2 id=the-configuration-files-you-need>The Configuration Files You Need<a hidden class=anchor aria-hidden=true href=#the-configuration-files-you-need>#</a></h2><p>Here&rsquo;s everything in one place for easy copy-paste:</p><h3 id=complete-project-structure>Complete Project Structure<a hidden class=anchor aria-hidden=true href=#complete-project-structure>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>task-api/
</span></span><span class=line><span class=cl>├── .claude/
</span></span><span class=line><span class=cl>│   ├── hooks.yml
</span></span><span class=line><span class=cl>│   ├── agents.yml
</span></span><span class=line><span class=cl>│   ├── output-styles.yml
</span></span><span class=line><span class=cl>│   ├── mcp-servers.yml
</span></span><span class=line><span class=cl>│   └── workflow.yml
</span></span><span class=line><span class=cl>├── src/
</span></span><span class=line><span class=cl>│   ├── main.py
</span></span><span class=line><span class=cl>│   ├── database.py
</span></span><span class=line><span class=cl>│   └── models.py
</span></span><span class=line><span class=cl>├── tests/
</span></span><span class=line><span class=cl>│   └── test_api.py
</span></span><span class=line><span class=cl>├── pyproject.toml
</span></span><span class=line><span class=cl>└── .env
</span></span></code></pre></div><p>Remember: configuration is powerful, but it&rsquo;s not magic. It&rsquo;s about encoding your best practices so they happen automatically. Start with what annoys you most, automate that, then build from there.</p><p>The best development environment is the one that gets out of your way and lets you focus on solving interesting problems.</p><p>Now go build something cool.</p><hr><p><em>Note: This tutorial assumes Claude Code v2.0+ with MCP support. Some features may vary based on your Claude Code version and available MCP servers.</em></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://memo.mx/posts/claude-code-advanced-features/><span class=title>« Prev</span><br><span>Claude Code Advanced Features: Hooks, Agents, and MCP Servers</span>
</a><a class=next href=https://memo.mx/posts/understanding-computer-networks-by-analogy/><span class=title>Next »</span><br><span>Understanding Computer Networks by Analogy</span></a></nav></footer></article></main><footer class=footer></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>